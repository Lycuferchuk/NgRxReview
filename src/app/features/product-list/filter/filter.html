<div class="nexus-card filter-panel">
  @if (loading) {
    <div class="filter-panel__loading">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Завантаження фільтрів...</p>
    </div>
  } @else {
    <div class="filter-panel__header">
      <h2 class="filter-panel__title">
        Фільтри
        @if (activeFiltersCount() > 0) {
          <span class="badge">{{ activeFiltersCount() }}</span>
        }
      </h2>
      <button
        mat-button
        color="warn"
        (click)="reset()"
        [disabled]="!hasActiveFilters()">
        Скинути
      </button>
    </div>

    <div class="results-info">
      Знайдено: {{ filteredCount() }} з {{ totalCount() }}
    </div>

    <form [formGroup]="form">
      <app-nxs-checkbox-form
        formControlName="category"
        [config]="categoryConfig" />

      <app-nxs-checkbox-form
        formControlName="inStock"
        [config]="inStockConfig" />

      <app-nxs-checkbox-form
        formControlName="rating"
        [config]="ratingConfig" />

      @if (selectedCategory !== 'all' && dynamicFilters.length > 0) {
        <div formGroupName="attributes" class="dynamic-filters">
          @for (filter of dynamicFilters; track filter.key; let i = $index) {
            @switch (filter.type) {
              @case ('checkbox') {
                <app-nxs-checkbox-form
                  [config]="dynamicFilterConfigs[i]"
                  [useFormArray]="true"
                  [formArray]="getAttributeArray(filter.key)" />
              }
              @case ('toggle') {
                <app-nxs-checkbox-form
                  [formControlName]="filter.key"
                  [config]="{ label: filter.label, type: 'boolean' }" />
              }
              @case ('radio') {
                <app-nxs-checkbox-form
                  [formControlName]="filter.key"
                  [config]="dynamicFilterConfigs[i]" />
              }
            }
          }
        </div>
      }
    </form>
  }
</div>
