<div class="product-details">
  <button
    mat-icon-button
    class="product-details__back-btn"
    (click)="goBack()">
    <mat-icon>arrow_back</mat-icon>
  </button>

  @if (loading()) {
    <nxs-skeleton-details></nxs-skeleton-details>
  } @else if (noData()) {
    <nxs-no-data [type]="emptyStateType.NO_DATA"></nxs-no-data>
  } @else if (product(); as product) {
    <mat-card class="nexus-card product-details__card">
      <div class="product-details__header">
        <img
          [src]="product.imageUrl"
          [alt]="product.name"
          class="product-details__image"
          nxsViewTransition="product-image"
          [nxsViewTransitionId]="product.id"
        />

        <div class="product-details__info">
          <h1 class="product-details__title">{{ product.name }}</h1>

          <div class="product-details__rating">
            <mat-icon>star</mat-icon>
            {{ product.rating }}/5
          </div>

          @if (product.inStock) {
            <span class="product-details__stock product-details__stock--available">
              <mat-icon>check_circle</mat-icon>
              Є в наявності
            </span>
          } @else {
            <span class="product-details__stock product-details__stock--out">
              <mat-icon>cancel</mat-icon>
              Немає в наявності
            </span>
          }

          <div class="product-details__price-actions">
            <span class="product-details__price">
              {{ product.price | currency: 'UAH' : 'symbol-narrow' }}
            </span>
            <button
              class="nexus-button"
              mat-flat-button
              color="primary"
              (click)="addToCart()"
              [disabled]="!product.inStock">
              <mat-icon>shopping_cart</mat-icon>
              Додати в кошик
            </button>
          </div>
        </div>
      </div>

      <mat-divider class="mt-12"></mat-divider>
      <div class="product-details__body">
        <div class="product-details__section">
          <h2 class="product-details__subtitle">Опис</h2>
          <div class="product-details__description-content">
            <p class="product-details__meta-item">
              <strong>Бренд:</strong> {{ product.brand }}
            </p>
            <p class="product-details__meta-item">
              <strong>Категорія:</strong> {{ product.category }}
            </p>
            @if (product.description) {
              <p class="product-details__description">{{ product.description }}</p>
            }
          </div>
        </div>

        @if (getFormattedSpecs().length > 0) {
          <mat-divider></mat-divider>

          <div class="product-details__section">
            <h2 class="product-details__subtitle">Характеристики</h2>
            <div class="product-details__specs">
              @for (spec of getFormattedSpecs(); track spec.key) {
                <div class="product-details__spec-item">
                  <span class="product-details__spec-key">{{ spec.label }}</span>
                  <span class="product-details__spec-divider"></span>
                  <span class="product-details__spec-value">{{ spec.value }}</span>
                </div>
              }
            </div>
          </div>
        }
      </div>
    </mat-card>
  }
</div>
